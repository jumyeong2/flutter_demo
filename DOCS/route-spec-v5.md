# CoSync Basic MVP Route Spec v5
## 비개발자/기획자용 가이드 문서

> **문서 목적**: 앱의 화면 이동 규칙, 사용자 플로우, 예외 상황 처리 방법을 명확히 정의하여 개발자와 기획자가 공통으로 이해할 수 있도록 정리한 문서입니다.

---

## 📋 목차
1. [MVP 기본 정책](#1-mvp-기본-정책)
2. [핵심 사용자 플로우](#2-핵심-사용자-플로우)
3. [화면별 동작 규칙](#3-화면별-동작-규칙)
4. [초대 링크 & 딥링크](#4-초대-링크--딥링크)
5. [세션 상태 & 진행 규칙](#5-세션-상태--진행-규칙)
6. [예외 상황 처리](#6-예외-상황-처리)
7. [데이터 구조 요약](#7-데이터-구조-요약)
8. [기술적 세부사항 (참고용)](#8-기술적-세부사항-참고용)

---

## 1. MVP 기본 정책

### 1.1 서비스 정책
- ✅ **무료 서비스**: MVP는 결제/플랜 로직 없음
- ✅ **2인 협업 필수**: A와 B 두 명이 함께 사용하는 구조 (1인 모드 없음)
- ✅ **샘플 리포트**: 입력 체험 없음, 완성형 문서만 보여줌 (잠금 CTA 포함)

### 1.2 진행 기준
- **문서 생성 가능 조건**: 합의 문장 8개 이상 확정
- **합의 시작 가능 조건**: A와 B 모두 질문 답변 8개 이상 완료
- **상태 전환**: 서버에서 자동으로 처리 (사용자가 직접 변경 불가)

---

## 2. 핵심 사용자 플로우

### 2.1 첫 방문자 플로우
```
랜딩 페이지 → 로그인/회원가입 → 팀 선택/생성 → 대시보드
```

### 2.2 기존 사용자 플로우
```
앱 실행 → 자동 로그인 확인 → 팀 컨텍스트 확인 → 대시보드
```

### 2.3 세션 진행 플로우
```
대시보드 → 세션 생성 → 질문 답변 → 상대 대기 → 합의 → 문서 생성 → 문서 보기
```

### 2.4 초대 링크 플로우
```
초대 링크 클릭 → 로그인(필요시) → 팀 가입 → 원래 목적지로 이동
```

---

## 3. 화면별 동작 규칙

### 3.1 공개 화면 (로그인 불필요)

#### 랜딩 페이지 (`/landing`)
- **접근**: 누구나 접근 가능
- **기능**: 서비스 소개, 사전신청 CTA
- **다음 단계**: 로그인/회원가입 버튼

#### 샘플 리포트 (`/sample`)
- **접근**: 누구나 접근 가능
- **기능**: 완성형 문서 미리보기 (읽기 전용)
- **제한**: 입력 체험 불가, 잠금 영역 클릭 시 모달 표시

---

### 3.2 인증 화면

#### 로그인 (`/auth/login`)
- **접근**: 로그인 필요 시 자동 이동
- **기능**: 이메일/비밀번호 로그인
- **성공 후**: 원래 가려던 화면으로 복귀 (또는 대시보드)

#### 회원가입 (`/auth/signup`)
- **접근**: 회원가입 버튼 클릭
- **기능**: 이메일/비밀번호 회원가입
- **성공 후**: 사용자 정보 생성 → 원래 가려던 화면으로 복귀 (또는 대시보드)

---

### 3.3 팀 관리 화면

#### 팀 선택 (`/team/select`)
- **접근 조건**: 로그인했지만 팀이 없는 경우
- **기능**: 
  - 기존 팀 목록 보기
  - 새 팀 만들기
  - 팀 초대 링크로 가입하기
- **다음 단계**: 팀 선택/생성 후 대시보드로 이동

#### 팀 생성 (`/team/create`)
- **접근**: 팀 선택 화면에서 "새 팀 만들기"
- **기능**: 팀 이름 입력, 팀 생성
- **성공 후**: 대시보드로 이동

#### 팀 가입 (`/team/join`)
- **접근**: 초대 링크 클릭 또는 팀 선택 화면에서 초대 코드 입력
- **파라미터**: 
  - `code`: 팀 코드 (필수, URL 쿼리 파라미터)
  - `redirect`: 가입 후 이동할 화면 (선택, 없으면 대시보드)
- **처리 순서**:
  1. **팀 정보 조회**: 팀 코드로 팀 정보 확인 (팀이 없으면 에러 처리)
  2. **멤버십 확인**: 현재 사용자가 이미 해당 팀의 멤버인지 확인
  3. **멤버십 처리**:
     - **이미 멤버인 경우**: 
       - 멤버 추가 작업 없음
       - 사용자의 `currentCompanyKey`를 해당 팀으로 설정 (서버 + 로컬 캐시)
       - 즉시 다음 단계로 진행
     - **새 멤버인 경우**: 
       - 팀의 멤버 목록에 사용자 추가 (역할: B)
       - 사용자의 `currentCompanyKey`를 해당 팀으로 설정 (서버 + 로컬 캐시)
  4. **이동**: redirect 파라미터가 있으면 해당 화면, 없으면 대시보드
- **사용 시나리오**:
  - 팀 초대 링크로 새 멤버 초대
  - 기존 멤버가 다른 기기에서 로그인하여 팀 재선택
  - 세션 초대 링크를 통해 팀 가입 후 세션으로 이동

---

### 3.4 워크스페이스 화면

#### 대시보드 (`/dashboard`)
- **접근 조건**: 로그인 + 팀 선택 완료
- **기능**:
  - 현재 팀의 세션 목록
  - 최근 문서 보기
  - 새 세션 만들기
- **제한**: 팀 멤버만 접근 가능

#### 세션 생성 (`/session/create`)
- **접근 조건**: 로그인 + 팀 선택 완료 + 팀 멤버
- **기능**: 새 세션 생성 (질문 세트 선택 등)
- **성공 후**: 세션 홈으로 이동

---

### 3.5 세션 진행 화면

#### 세션 홈 (`/session/:sessionId`)
- **접근 조건**: 로그인 + 세션 멤버
- **기능**: 세션 상태 확인, 다음 단계로 이동하는 CTA 버튼
- **CTA 규칙** (아래 5.3 참고)

#### 질문 답변 (`/session/:sessionId/questions`)
- **접근 조건**: 세션 상태가 `answering` 또는 `draft`
- **기능**: 10개 질문에 대한 답변 입력
- **저장**: 답변 저장 시 자동으로 진행률 업데이트
- **제한**: 
  - 상태가 `consensus` 또는 `final`이면 접근 불가 (세션 홈으로 이동)
  - 8개 이상 완료하면 "합의 시작" 가능 상태로 전환

#### 대기 화면 (`/session/:sessionId/wait`)
- **접근 조건**: 내가 8개 이상 완료했지만 상대가 아직 진행 중
- **기능**: 
  - 상대 진행률 표시 ("상대가 작성 중입니다 (x/10)")
  - 초대 링크 재공유 버튼
- **자동 전환**: 상대도 8개 완료하면 "합의 시작" 가능

#### 합의 화면 (`/session/:sessionId/consensus`)
- **접근 조건**: A와 B 모두 8개 이상 완료
- **기능**: 질문별로 합의 문장 확정
- **저장**: 합의 확정 시 자동으로 카운트 업데이트
- **제한**: 8개 미만 완료 시 접근 불가 (질문 답변 또는 대기 화면으로 이동)

#### 문서 생성 (`/session/:sessionId/generate`)
- **접근 조건**: 합의 문장 8개 이상 확정
- **기능**: 최종 문서 생성
- **제한**: 8개 미만 확정 시 접근 불가 (합의 화면으로 이동)
- **성공 후**: 생성된 문서 보기 화면으로 이동

---

### 3.6 문서 화면

#### 최신 문서 (`/doc/latest`)
- **접근 조건**: 로그인
- **기능**: 현재 팀의 최신 문서 보기
- **파라미터**: `companyKey` (선택, URL 쿼리 파라미터 또는 사용자의 현재 팀)
- **처리 순서**:
  1. **팀 코드 확인**:
     - URL에 `companyKey` 파라미터가 있으면 해당 팀 사용
     - 없으면 로그인한 사용자의 `currentCompanyKey` 사용
     - 둘 다 없으면 팀 선택 화면으로 이동
  2. **최신 문서 확인**:
     - 팀 정보(`companies/{companyKey}`)를 조회하여 `latestDocId` 확인
     - `latestDocId`가 없으면: "아직 생성된 문서가 없습니다" 안내 후 대시보드로 이동
     - `latestDocId`가 있으면: 해당 문서 보기 화면(`/doc/{docId}`)으로 자동 이동
- **사용 예시**:
  - 내 팀 최신 문서: `/doc/latest` 클릭 → 자동으로 `/doc/{latestDocId}`로 이동
  - 특정 팀 최신 문서: `/doc/latest?companyKey=팀코드` → 해당 팀의 최신 문서로 이동

#### 문서 보기 (`/doc/:docId`)
- **접근 조건**: 로그인 + 문서 소유 팀의 멤버
- **기능**: 생성된 문서 상세 보기 (1페이지 요약, 합의 문장 목록)
- **처리 순서**:
  1. **문서 존재 확인**: 문서가 없으면 "문서를 찾을 수 없습니다" 안내 후 대시보드로 이동
  2. **팀 정보 확인**: 문서의 `companyKey`가 없으면 에러 페이지로 이동
  3. **멤버십 검증**: 문서를 소유한 팀의 멤버인지 확인
     - 멤버가 아니면: 팀 가입 화면(`/team/join?code={companyKey}&redirect=/doc/{docId}`)으로 이동
     - 멤버면: 문서 화면 표시
- **표시 내용**:
  - 1페이지 요약 (`summary1p`)
  - 합의 문장 목록 (`decisionLogs`) - 각 문장의 확정일 포함

---

### 3.7 설정 화면

#### 설정 (`/settings`)
- **접근 조건**: 로그인
- **기능**: 프로필, 팀 관리, 로그아웃

#### 팀 설정 (`/settings/team`)
- **접근 조건**: 로그인 + 팀 멤버
- **기능**: 
  - **팀 정보 표시**: 팀 이름, 팀 코드
  - **팀 초대 링크 복사**: 
    - "팀 초대 코드 복사" 버튼 클릭 시 초대 링크가 클립보드에 복사됨
    - 초대 링크 형식: `/team/join?code={팀코드}`
    - 복사 성공 시 "초대 링크가 복사되었습니다" 안내 메시지 표시
  - **팀 나가기**: 
    - "팀 나가기" 버튼 클릭 시 확인 다이얼로그 표시
    - 확인 시 다음 작업 수행:
      1. 사용자의 `currentCompanyKey`를 서버에서 `null`로 설정
      2. 앱 내 로컬 캐시에서 팀 정보 삭제
      3. 팀 선택 화면(`/team/select`)으로 이동
    - **참고**: 팀을 나가도 팀의 멤버 목록에서 완전히 제거되지는 않으며, 단순히 사용자의 현재 팀 컨텍스트만 초기화됩니다. 같은 팀에 다시 가입하려면 팀 가입 화면에서 팀 코드를 입력하거나 초대 링크를 사용하면 됩니다.

---

## 4. 초대 링크 & 딥링크

### 4.1 링크 형식 (통일 규칙)
- **외부 공유**: `code` 파라미터 하나로 통일 (code = 팀 코드)
- **표준 링크**:
  - 팀 초대: `/team/join?code={팀코드}&redirect=/dashboard`
  - 세션 초대: `/team/join?code={팀코드}&redirect=/session/{세션ID}`

### 4.2 딥링크 처리 규칙
1. **비로그인 사용자**:
   - 초대 링크 클릭 → 로그인 화면으로 이동
   - 로그인 성공 후 → 원래 목적지(초대 링크)로 자동 복귀
   
2. **로그인 사용자**:
   - 초대 링크 클릭 → 팀 가입 처리
   - 가입 성공 후 → redirect 파라미터가 있으면 해당 화면, 없으면 대시보드

3. **직접 세션 링크 접근** (`/session/:sessionId`):
   - 세션 정보 확인 → 팀 멤버 확인 → 팀 컨텍스트 자동 설정 → 세션 화면 진입
   - 멤버가 아니면: 팀 가입 화면으로 이동

### 4.3 외부 링크(딥링크) 처리
앱이 외부 링크(예: 이메일, 메신저, 브라우저)로 열릴 때 자동으로 처리됩니다:

1. **지원하는 링크 형식**:
   - 팀 가입: `/team/join?code={teamCode}&redirect={path}`
   - 세션: `/session/{sessionId}` 또는 `/session/{sessionId}/questions`, `/session/{sessionId}/wait`, `/session/{sessionId}/consensus`, `/session/{sessionId}/generate`
   - 문서: `/doc/{docId}` 또는 `/doc/latest?companyKey={key}`

2. **처리 흐름**:
   - **미로그인 사용자**: 
     - 링크 경로를 `pendingRoutePath`에 저장
     - 로그인 화면으로 이동
     - 로그인 성공 후 저장된 경로로 자동 복귀
   - **로그인 사용자**: 
     - 링크 경로를 파싱하여 적절한 화면으로 직접 이동
     - Guard가 자동으로 실행되어 권한 검증 수행

3. **웹 환경**: 
   - 브라우저 URL 변경 시 자동으로 딥링크 처리
   - URL이 변경되면 해당 경로로 자동 라우팅

4. **모바일 환경**: 
   - 앱이 외부 링크로 열릴 때 링크 URL을 파싱하여 처리
   - Universal Links (iOS) / App Links (Android) 지원

--- 

## 5. 세션 상태 & 진행 규칙

### 5.1 세션 상태 정의
| 상태 | 설명 | 다음 단계 |
|------|------|----------|
| `draft` | 세션 생성됨, 아직 입력 시작 전 | 질문 답변 시작 |
| `answering` | A/B가 질문 답변 입력 중 | 8개 이상 완료 대기 |
| `ready_for_consensus` | A/B 모두 8개 이상 완료 (합의 시작 가능) | 합의 시작 |
| `consensus` | 합의 문장 확정 작업 중 | 8개 이상 확정 대기 |
| `final` | 합의 8개 이상 확정 + 문서 생성 완료 | 문서 보기 |

### 5.2 상태 전환 규칙 (자동)
- **draft → answering**: 첫 답변 저장 시
- **answering → ready_for_consensus**: A와 B 모두 8개 이상 완료 시 (서버에서 자동 전환)
- **ready_for_consensus → consensus**: "합의 시작" 버튼 클릭 시
- **consensus → final**: 합의 8개 이상 확정 + 문서 생성 완료 시

### 5.3 세션 홈 CTA 버튼 규칙
세션 홈 화면의 버튼은 현재 상태와 진행률에 따라 자동으로 변경됩니다:

#### 상태: `answering` (답변 입력 중)
- 내가 8개 미만 완료 → **"답변 입력하기"** → 질문 답변 화면
- 내가 8개 이상, 상대가 8개 미만 → **"상대 입력 대기"** → 대기 화면
- 내가 8개 이상, 상대도 8개 이상 → **"합의 시작하기"** → 합의 화면
  - (참고: 이 경우 서버에서 상태가 `ready_for_consensus`로 자동 전환됨)

#### 상태: `ready_for_consensus` (합의 시작 가능)
- **"합의 시작하기"** → 합의 화면

#### 상태: `consensus` (합의 진행 중)
- **"합의 계속하기"** → 합의 화면

#### 상태: `final` (문서 생성 완료)
- **"문서 보기"** → 생성된 문서 보기 화면

### 5.4 화면 접근 제한 (게이팅)
각 화면 진입 시 자동으로 검증하여 불가능한 상태면 다른 화면으로 이동시킵니다:

- **질문 답변 화면**: 상태가 `consensus` 또는 `final`이면 → 세션 홈으로 이동
- **합의 화면**: A 또는 B가 8개 미만 완료면 → 질문 답변 또는 대기 화면으로 이동
- **문서 생성 화면**: 합의 확정이 8개 미만이면 → 합의 화면으로 이동

---

## 6. 예외 상황 처리

### 6.1 네트워크 오류
- **증상**: 저장 실패, 화면 로딩 실패
- **처리**: 
  - 토스트 메시지: "연결을 확인해주세요"
  - 재시도 버튼 제공
  - 임시 저장 상태 표시 ("저장 중/동기화 대기")

### 6.2 권한 오류
- **증상**: 멤버가 아닌데 접근 시도
- **처리**: 
  - 팀 가입 화면으로 이동
  - 안내 메시지: "이 팀의 멤버가 아닙니다"

### 6.3 데이터 없음
- **세션 없음**: "세션을 찾을 수 없습니다" → 대시보드로 이동
- **문서 없음**: "문서를 찾을 수 없습니다" → 대시보드로 이동
- **최신 문서 없음**: "아직 생성된 문서가 없습니다" → 대시보드로 이동

### 6.4 동시성 충돌
- **합의 확정 충돌**: 
  - 상대가 먼저 수정한 경우: "상대가 방금 수정했습니다. 최신 내용을 불러옵니다." 안내
  - 자동으로 최신 내용 로드
- **상태 전환 충돌**:
  - 상대가 먼저 조건을 충족한 경우: "상대가 먼저 조건을 충족했어요. 곧 합의 단계로 전환됩니다." 안내
  - 자동으로 상태 업데이트

### 6.5 무한 루프 방지
- **규칙**: 에러 발생 시 절대 앱 진입 화면(`/`)으로 보내지 않음
- **대신**: 대시보드 또는 팀 선택 화면으로 이동

---

## 7. 데이터 구조 요약

### 7.1 사용자 정보 (`users`)
- 이메일, 생성일, 현재 팀 코드

### 7.2 팀 정보 (`companies`)
- 팀 이름, 생성일, 최신 문서 ID, 멤버 목록 (A/B 역할)

### 7.3 세션 정보 (`sessions`)
- 팀 코드, 상태, 생성일
- 참여자 정보 (A/B 사용자 ID)
- 진행률 (각자 완료 문항 수)
- 완료자 목록 (8개 이상 완료한 사용자)
- 확정된 질문 ID 목록 (합의 완료된 질문들)
- 최종 문서 ID

### 7.4 문서 정보 (`documents`)
- 팀 코드, 세션 ID, 생성일
- 1페이지 요약, 합의 문장 목록

---

## 8. 기술적 세부사항 (참고용)

> 이 섹션은 개발자용 참고 정보입니다. 기획자는 넘어가셔도 됩니다.

### 8.1 화면 보호 규칙 (Guard)
각 화면은 접근 전에 자동으로 검증합니다:

- **AuthGuard**: 로그인 확인 (미로그인 시 로그인 화면으로 이동)
- **CompanyGuard**: 팀 선택 확인 (팀 없으면 팀 선택 화면으로 이동)
- **MemberGuard**: 팀 멤버 확인 (멤버 아니면 팀 가입 화면으로 이동)
- **SessionGuard**: 세션 접근 권한 확인 (세션 정보 확인 + 팀 멤버 확인 + 팀 컨텍스트 자동 설정)

### 8.2 앱 진입 분기 (`/`)
앱 실행 시 자동으로 다음 순서로 분기합니다:

1. **딥링크 복귀**: 이전에 가려던 화면이 있으면 그곳으로 이동
2. **미로그인**: 랜딩 페이지
3. **로그인 + 팀 없음**: 팀 선택 화면
4. **로그인 + 팀 있음**: 대시보드

### 8.3 저장 로직

#### 질문 답변 저장
1. 답변 저장
2. 진행률 업데이트 (완료 문항 수)
3. 8개 이상 완료 시: 완료자 목록에 추가
4. A와 B 모두 8개 이상 완료 시: 상태를 `ready_for_consensus`로 자동 전환 (서버에서 처리)

#### 합의 확정 저장
1. 합의 문장 저장
2. 확정된 질문 ID 목록에 추가
3. 8개 이상 확정 시: 문서 생성 가능

#### 문서 생성
1. 문서 생성
2. 세션 상태를 `final`로 변경
3. 팀의 최신 문서 ID 업데이트

### 8.4 동기화 규칙
- **서버가 기준**: 사용자의 현재 팀 정보는 서버가 기준
- **앱 시작 시**: 로그인 상태면 서버에서 최신 팀 정보를 가져와서 로컬에 저장
- **불일치 시**: 서버 값으로 덮어쓰기

### 8.5 구현 파일 구조
라우팅 시스템은 다음과 같은 파일 구조로 구현되어 있습니다:

```
lib/
├── router/
│   ├── routes.dart                    # Routes 상수 정의
│   ├── app_pages.dart                 # GetPage 라우팅 트리
│   └── guards/
│       ├── auth_guard.dart            # 로그인 확인 미들웨어
│       ├── company_guard.dart         # 팀 컨텍스트 확인 미들웨어
│       ├── member_guard.dart          # 팀 멤버십 확인 미들웨어
│       └── session_guard.dart         # 세션 접근 권한 확인 미들웨어
├── ui/
│   └── page/
│       └── entry/
│           └── entry_page.dart        # Entry 페이지 (앱 진입 분기)
└── main.dart                          # GetMaterialApp 라우팅 연결
```

### 8.6 Routes 상수 사용법
모든 라우트 경로는 `Routes` 클래스의 상수로 정의되어 있습니다:

```dart
// 기본 라우트
Routes.entry              // '/'
Routes.landing            // '/landing'
Routes.login              // '/auth/login'
Routes.dashboard          // '/dashboard'

// 동적 경로 생성 헬퍼 메서드
Routes.sessionHomePath('abc123')           // '/session/abc123'
Routes.sessionQuestionsPath('abc123')      // '/session/abc123/questions'
Routes.docViewPath('doc456')               // '/doc/doc456'
Routes.teamJoinPath(code: 'team123', redirect: '/dashboard')
```

### 8.7 Guard 미들웨어 동작 방식
각 Guard는 `GetMiddleware`를 상속받아 `redirect` 메서드를 구현합니다:

- **통과**: `null` 반환 → 다음 Guard 또는 화면으로 진행
- **리다이렉트**: `RouteSettings` 반환 → 해당 경로로 이동

**Guard 실행 순서**:
1. 라우트에 정의된 순서대로 실행
2. 하나라도 리다이렉트하면 나머지 Guard는 실행되지 않음
3. 모든 Guard 통과 시 해당 화면으로 진입

### 8.8 pendingRoutePath 저장/복귀 메커니즘
딥링크 복귀를 위한 저장소는 `GetStorage`를 사용합니다:

- **저장 키**: `pendingRoutePath` (경로), `pendingRouteType` (타입)
- **저장 시점**: AuthGuard에서 미로그인 감지 시
- **복귀 시점**: 로그인/회원가입 성공 후 Entry 페이지에서 처리
- **Clear 시점**: 목적지 화면이 실제로 진입 성공했을 때만 (화면의 onReady/onInit에서)

### 8.9 Entry 페이지 분기 로직
Entry 페이지(`/`)는 앱 진입 시 자동으로 다음 순서로 분기합니다:

1. **pendingRoutePath 확인** → 있으면 해당 경로로 이동 (Guard 실행)
2. **로그인 상태 확인** → 미로그인 시 `/landing`
3. **currentCompanyKey 확인** → 없으면 `/team/select`
4. **기본 진입** → `/dashboard`

**주의사항**: Entry는 Guard를 거치지 않고 내부에서만 분기합니다.

### 8.10 라우팅 사용 예시
```dart
// 기본 네비게이션
Get.toNamed(Routes.dashboard);
Get.offNamed(Routes.login);  // 현재 화면 제거 후 이동
Get.offAllNamed(Routes.entry);  // 모든 화면 제거 후 이동

// 동적 경로 사용
Get.toNamed(Routes.sessionHomePath(sessionId));
Get.toNamed(Routes.docViewPath(docId));

// 쿼리 파라미터 포함
Get.toNamed(Routes.teamJoinPath(code: companyKey, redirect: '/dashboard'));

// Arguments 전달 (Error 페이지 등)
Get.toNamed(Routes.error, arguments: {
  'message': '세션을 찾을 수 없습니다',
  'fallbackRoute': Routes.dashboard,
});
```

### 8.11 의존성
라우팅 시스템 구현에 필요한 패키지:

```yaml
dependencies:
  get: ^4.7.3                    # GetX (라우팅, 상태 관리)
  get_storage: ^2.1.1            # 로컬 저장소 (pendingRoutePath)
  firebase_auth: ^6.1.2           # 인증 (AuthGuard)
  cloud_firestore: ^6.1.0         # 데이터베이스 (Guard 검증)
```

---

## 📝 변경 이력

- **v5.3** (2025-01-XX): pendingRoutePath 복귀 및 딥링크 처리 구현
  - 로그인 성공 후 pendingRoutePath 복귀 로직 구현 (이미 구현되어 있었음)
  - 회원가입 성공 후 pendingRoutePath 복귀 로직 추가 (AgreementAdjustIntroStep2Page)
  - DeepLinkService 구현: 외부 링크 진입 시 자동 라우팅 처리
  - 웹 환경 URL 변경 감지 및 딥링크 처리 연동
- **v5.2** (2025-01-XX): 문서 접근 및 팀 설정 기능 구현
  - `/doc/latest`: 팀 코드 파라미터 처리 및 최신 문서 자동 이동 구현
  - `/doc/:docId`: 문서 접근 권한 검증 및 멤버십 확인 로직 구현
  - `/settings/team`: 팀 초대 링크 복사 및 팀 나가기 기능 구현
  - 팀 가입 로직 개선: 기존 멤버 재가입 시 컨텍스트만 설정하는 로직 명확화
- **v5.1** (2025-01-XX): 라우팅 시스템 구현 완료
  - Routes 상수 파일 생성
  - Guard 미들웨어 구현 (AuthGuard, CompanyGuard, MemberGuard, SessionGuard)
  - GetPage 라우팅 트리 구성 (app_pages.dart)
  - Entry 페이지 구현 (앱 진입 분기 로직)
  - main.dart 라우팅 연결
- **v5**: Entry/pendingRoute 루프 방지, 세션 상태 전환 명확화, 에러 처리 보완
- **v4**: 동시성 처리, confirmedQuestionIds 안전 캐시
- **v3**: SessionGuard 에러 시나리오, /doc/latest null 처리

---

## ❓ 자주 묻는 질문

### Q1. 사용자가 세션 링크를 직접 공유하면?
A. 세션 정보를 확인하여 팀 멤버인지 검증하고, 멤버가 아니면 팀 가입 화면으로 이동합니다. 멤버면 자동으로 팀 컨텍스트를 설정하고 세션 화면으로 진입합니다.

### Q2. 두 명이 동시에 8개를 완료하면?
A. 서버에서 자동으로 상태를 전환하므로, 먼저 완료한 사용자가 상태 전환을 트리거하고, 다른 사용자는 실시간으로 업데이트된 상태를 받아서 화면이 자동으로 변경됩니다.

### Q3. 네트워크가 끊겼을 때 저장은?
A. 저장 실패 시 "저장 중/동기화 대기" 상태를 표시하고, 네트워크 복구 시 자동으로 재시도하거나 사용자가 수동으로 재시도할 수 있습니다.

### Q4. 팀을 나간 후 다시 같은 팀에 가입하면?
A. "팀 나가기"는 단순히 사용자의 현재 팀 컨텍스트를 초기화하는 것이며, 팀의 멤버 목록에서 제거하지는 않습니다. 따라서 같은 팀 코드로 다시 가입하면, 이미 멤버로 인식되어 멤버 추가 없이 팀 컨텍스트만 다시 설정됩니다.

### Q4-1. 팀 나가기를 하면 다른 멤버에게 영향을 주나요?
A. 아닙니다. 팀 나가기는 개인 사용자의 현재 팀 컨텍스트만 초기화하며, 팀 정보나 다른 멤버에게는 영향을 주지 않습니다. 다만, 팀을 나간 사용자는 더 이상 해당 팀의 세션이나 문서에 접근할 수 없으며, 다시 팀에 가입해야 합니다.

### Q5. 라우팅 시스템은 어떻게 구현되어 있나요?
A. GetX의 GetPage와 GetMiddleware를 사용하여 구현되어 있습니다. 각 화면은 Guard 미들웨어로 보호되며, Entry 페이지에서 앱 진입 시 자동 분기가 처리됩니다. 자세한 내용은 "8. 기술적 세부사항" 섹션을 참고하세요.

### Q6. 새로운 화면을 추가하려면 어떻게 하나요?
A. 다음 단계를 따르세요:
1. `lib/router/routes.dart`에 라우트 상수 추가
2. `lib/router/app_pages.dart`에 GetPage 추가 (필요한 Guard 지정)
3. 실제 페이지 위젯 생성
4. `app_pages.dart`의 placeholder를 실제 페이지로 교체

### Q7. 최신 문서 보기에서 특정 팀의 문서를 보고 싶으면?
A. URL에 쿼리 파라미터로 `companyKey`를 추가하면 됩니다. 예: `/doc/latest?companyKey=팀코드`. 파라미터가 없으면 자동으로 로그인한 사용자의 현재 팀을 사용합니다.

### Q8. 문서를 보려고 했는데 "팀의 멤버가 아닙니다"라는 메시지가 나오면?
A. 해당 문서가 속한 팀의 멤버가 아닌 경우 발생합니다. 자동으로 팀 가입 화면으로 이동하므로, 팀 코드를 입력하거나 초대 링크를 통해 팀에 가입하면 문서를 볼 수 있습니다. 문서 보기 화면(`/doc/{docId}`)은 가입 후 자동으로 복귀됩니다.

---

**문서 버전**: v5.1  
**최종 업데이트**: 2025-01-XX  
**작성자**: 개발팀  
**검토자**: 기획팀

---

## 📚 추가 참고 자료

### 구현 체크리스트
- [x] Routes 상수 파일 생성
- [x] Guard 미들웨어 구현 (AuthGuard, CompanyGuard, MemberGuard, SessionGuard)
- [x] GetPage 라우팅 트리 구성
- [x] Entry 페이지 구현
- [x] main.dart 라우팅 연결
- [x] 문서 화면 구현 (`/doc/latest`, `/doc/:docId`)
- [x] 팀 설정 화면 구현 (`/settings/team`)
- [x] 팀 가입 로직 구현 (기존 멤버 재가입 처리)
- [x] 로그인/회원가입 성공 후 pendingRoutePath 복귀 로직
- [x] 딥링크 처리 (외부 링크 진입)

### 다음 구현 단계
1. **팀 관리 페이지**: TeamSelectPage, TeamCreatePage, TeamJoinPage
2. **대시보드**: DashboardPage
3. **세션 페이지**: SessionHomePage, SessionQuestionsPage, SessionWaitPage, SessionConsensusPage, SessionGeneratePage
4. **문서 페이지**: DocLatestPage, DocViewPage
5. **설정 페이지**: SettingsPage, SettingsProfilePage, SettingsTeamPage
6. **회원가입 페이지**: SignupPage (기존 AgreementAdjustIntroPage와 통합 검토)
